---
import PageTitle from '../PageTitle.astro';
import PageIntro from '../PageIntro.astro'
import ProjectList from '../ProjectList.astro'
import ProjectFilter from '../ProjectFilter.astro';
import { set } from 'astro:schema';

const { data } = Astro.props;
const pageTitle = data.title || "";
const pageIntroduction = data.content;
const projectData = data.work.nodes;

const allServices = projectData.flatMap((project:any) => 
  project.projectMeta?.services?.nodes?.map((service:any) => service.title) || []
).filter(Boolean);

const allCategories = projectData.flatMap((project:any) =>
  project.projectMeta?.category?.nodes?.map((category:any) => category.name) || []
).filter(Boolean);

const uniqueServices = [...new Set(allServices)]; // list tags
const uniqueCategories = [...new Set(allCategories)]; // categories

---

<PageTitle title={pageTitle} />
<PageIntro>
  {pageIntroduction &&
    <Fragment slot="column-one" set:html={pageIntroduction} />
  }
  <ProjectFilter filteritems={uniqueCategories} slot="column-two" />
</PageIntro>

<ProjectList projects={projectData} layout="list" fitCards={true} />